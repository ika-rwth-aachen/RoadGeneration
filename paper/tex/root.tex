%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%2345678901234567890123456789012345678901234567890123456789012345678901234567890
%        1         2         3         4         5         6         7         8

%\documentclass[letterpaper, 10 pt, conference]{ieeeconf}  % Comment this line out if you need a4paper

\documentclass[a4paper, 10pt, conference]{ieeeconf}      % Use this line for a4 paper

\IEEEoverridecommandlockouts                              % This command is only needed if 
                                                          % you want to use the \thanks command

\overrideIEEEmargins                                      % Needed to meet printer requirements.

%In case you encounter the following error:
%Error 1010 The PDF file may be corrupt (unable to open PDF file) OR
%Error 1000 An error occurred while parsing a contents stream. Unable to analyze the PDF file.
%This is a known problem with pdfLaTeX conversion filter. The file cannot be opened with acrobat reader
%Please use one of the alternatives below to circumvent this error by uncommenting one or the other
%\pdfobjcompresslevel=0
%\pdfminorversion=4

% See the \addtolength command later in the file to balance the column lengths
% on the last page of the document

% The following packages can be found on http:\\www.ctan.org
\usepackage{graphicx} % for pdf, bitmapped graphics files
%\usepackage{epsfig} % for postscript graphics files
\usepackage{mathptmx} % assumes new font selection scheme installed
%\usepackage{times} % assumes new font selection scheme installed
\usepackage{amsmath} % assumes amsmath package installed
\usepackage{amssymb}  % assumes amsmath package installed
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{multirow} % merge columns in rows
\usepackage{listings} % code snippets
\usepackage{subcaption} % using subfigures
\usetikzlibrary{calc}   % using calculation feature of tikz

\title{\LARGE \bf
Generation of Complex Road Networks Using a Simplified Logical Description for the Validation of Automated Vehicles*
}


\author{Daniel Becker$^{1}$, Fabian Ru{\ss}$^{1}$ and Lutz Eckstein$^{2}$% <-this % stops a space
\thanks{*This research is funded by the SET Level 4to5 research initiative, promoted by the	Federal Ministry for Economic Affairs and Energy (BMWi).}% <-this % stops a space
\thanks{$^{1}$Daniel Becker and Fabian Ru{\ss} are with the automated driving department of the Institute for Automotive Engineering (ika), RWTH Aachen University, 52074 	Aachen, Germany {\tt\small \{daniel.becker, fabian.russ\}@ika.rwth-aachen.de}}%
\thanks{$^{2}$Lutz Eckstein is head of the Institute for Automotive Engineering (ika), RWTH Aachen University, 52074 Aachen, Germany {\tt\small lutz.eckstein@ika.rwth-aachen.de}}%
}

\begin{document}

\maketitle
\thispagestyle{empty}
\pagestyle{empty}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract} % TODO: write abstract
The verification and validation of automated driving functions is an essential building block in the process of releasing those functions to the public.  
\end{abstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{INTRODUCTION}
The interest in autonomous driving has increased considerably in recent year, both in research and society. To assure the safety of automated driving functions (ADF), verification and validation methods need to be developed and established. The approval of an ADF for public road traffic demands compliance with safety requirements regarding functionality. The requirements include the error-free functional verification over several billion test kilometers. Wachenfeld and Winner [ref] state that the distance to prove an ADF amounts 6.62 billion test kilometers. With a hypothetically 50~\% chance this prove would say that the ADF is twice as god as a human driver. Since this distance seems unreal and economically not acceptable, Schuldt et al. [ref] advise a scenario based testing. In order to shorten the test time, save costs and detect functional errors at an early development stage, simulation is well suited. The approach is also appropriate to create any number of scenarios and to present critical driving situations without endangering people.

Scenario based testing introduces three different stages to describe scenarios systematically: functional, logical and concrete [ref]. The term functional states a linguistic description which allows experts to talk about scenarios at an early stage of the development process. In logical scenarios parameters and ideally their probability distributions are provided. Finally, concrete scenarios specify a distinct value for each parameter which makes them feasible to be executed reproducible in a simulation or on proving grounds. 

This kind of description uses the subdivisions of the six-layer model by Eckstein [ref], which is based on the layer model in Schuldt et al.[ref]. In this model a scenario get divided in basic components and only an interaction between all the six layers represents a complete scenario. The three lower layers describe the static part of the scenario, i.e. the road. Layer four focuses on moving objects, whereas layer five and six describe environmental conditions and vehicle-to-everything (V2X) communication, respectively. Detailed discussion in [ref hendrik eindhoven] (oder schreibt man das nicht?)

Current research initiatives such as SET Level 4to5 (footnote?) address simulative scenario based testing with focus on inner city traffic. Besides layer four which describes the dynamic behavior of all participants, the static scenery has to be taken into account as well. The latter is described within layer one to three and has to be defined in a logical and concrete manner, respectively. The open source standard format OpenDRIVE [ref asam] is suitable for concrete descriptions of road networks and is widely used in industry and research. However, by now there is no standardized logical road description format which is easy to use and capable to be transfered into OpenDRIVE.
 
This article introduces a prototypical logical description language for complex road networks and a tool which generates concrete, standardized OpenDRIVE maps which may be used for the simulative testing of ADF. An example which outlines the idea of the concept is shown in Fig.~\ref{fig_motivation}

%To assure the safety of automated driving functions (ADF), verification and validation methods need to developed and established. (testfahrten und nötige km. etc erklären. zu Szenarien und simulation überleiten)

%One approach to reach this state is scenario based testing. [ref] proposed different stages of scenarios: functional, logical and concrete. The term functional states a linguistic description which allows experts to talk about scenarios at an early stage of the development process. In logical scenarios parameters and ideally their probability distributions are provided. Finally, concrete scenarios specify a distinct value for each parameter which makes them feasible to be executed reproducible in a simulation or on proving grounds. Each stage can be divided into six levels (ref. EN layer ,hendrik) where the three lower layers describe the static part of the scenario, i.e. the road. Layer four focuses on moving objects, whereas layer five and six describe environmental conditions and vehicle-to-everything (V2X) communication, respectively. Detailed discussion in [ref hendrik eindhoven] (oder schreibt man das nicht?)

%Current research initiatives such as SET Level 4to5 (footnote?) address simulative scenario based testing with focus on inner city traffic. Besides layer four which describes the dynamic behavior of all participants, the static scenery has to be taken into account as well. The latter is described within layer one to three and has to be defined in a logical and concrete manner, respectively. The open source standard format OpenDRIVE [ref asam] is suitable for concrete descriptions of road networks and is widely used in industry and research. However, by now there is no standardized logical road description format which is easy to use and capable to be transfered into OpenDRIVE. 

%This article introduces a prototypical logical description language for complex road networks and a tool which generates concrete, standardized OpenDRIVE maps which may be used for the simulative testing of ADF. An example which outlines the idea of the concept is shown in Fig.~\ref{fig_motivation}

\begin{figure}[tpb] 		
	\centering
	\includegraphics{fig/motivation.png}
	\caption{Graphical example of input and output of the road generation tool. As a minimal input two reference lines with assigned road types and a coupling point are sufficient to generate an intersection written in valid OpenDRIVE. (OpenDRIVE visualized in CarMaker 8.0[ref?])}
	\label{fig_motivation}
\end{figure}
%\begin{figure}
%	\begin{tikzpicture}
%	\node[anchor=west](layer6) at (0,7.4) {\small Layer 6};
%	\node[anchor=west](layer5) at (0,6.1) {\small Layer 5};
%	\node[anchor=west](layer4) at (0,4.9) {\small Layer 4};
%	\node[anchor=west](layer3) at (0,3.6) {\small Layer 3};
%	\node[anchor=west](layer2) at (0,2.3) {\small Layer 2};
%	\node[anchor=west](layer1) at (0,0.8) {\small Layer 1};
%	\begin{scope}[xshift=1.22cm]
%	\node[anchor=south west,inner sep=0] (image) at (0,0) {\includegraphics[width=0.4\textwidth]{fig/en_layers_raw.png}};
%	\end{scope}
%	\end{tikzpicture}
%	\caption{The data layers for the description of a scenario following~\cite{bock2018data} and~\cite{bagschik2018ontology}}
%	\label{fig:datalayers}
%\end{figure}
\section{RELATED WORK}
During the research initiative PEGASUS [ref] these concepts have been developed and utilized within the domain German motorway. Furthermore, the main focus has been on layer four. Nevertheless, when moving the testing domain to inner city scenarios such as the driving behavior on intersections, layers one to three are much more complex. Motorways usually consist of parallel lanes which follow curves with big radii. Such a road is not complicated to describe and generate. It can be done automatically with low effort. [ref. menzel et al.] propose a method to create a standardized road network in the OpenDRIVE format from a logical (and functional) road description. However, inner city intersections are more complex both in the logical description and in terms of the concrete format. 

die Frage ist, was alles "related" ist... eventuell kuerzer halten und laengere introduction? \textit{bibtex platzhalter} \cite{BagschikG..2018} \cite{Roesener2017}

\textit{hier muss noch der DLR ODR generator und deren logische Beschreibung für Autobahnen aus Pegasus rein \cite{dlrODRgen}}
% TODO: section related work
\section{METHODOLOGY}
The concept presented in this paper aims to offer a description for road networks which allows easy modifications of the map due to a non-redundant design. Further, it is possible to provide limited information for intersections and lane definitions since some default configurations for main and access roads are defined. The input shall be translated into a concrete standardized road description format. With the logical description comes a road generation tool that calculates all required OpenDRIVE quantities from the simplified input. We use XML to store the input and the corresponding OpenDRIVE output is saved in XML as well. This way we attempt to close a gap in the pipeline of defining logical scenarios on intersections and make them executable in a concrete manner.

\section{LOGICAL ROAD DESCRIPTION}
The proposed logical road description is derived from the reference line concept used in OpenDRIVE [ref]. This means that each lane is described by an offset from a reference line defined in the $x,y$-plane (topview). However, in contrast to OpenDRIVE we introduce some simplifications and eliminate redundancies along the reference line. Each road segment consists of the geometric primitives line, arc and spiral, which is motivated by the federal guidelines for road constructions [ref]. A simplified illustration of the road network's XML structure is shown in Fig.~\ref{fig_schema}. On the first level under the \textit{roadNetwork} tag all segments are defined and links which connect them can be stated. In addition, "loose ends" of segments can be automatically connected within the \textit{closeRoadNetwork} tag. As illustrated, segments might be T-/X-junctions, roundabouts and connection roads. 

In the following sections, the reference line is examined more detailed, followed by the description of the input for the logical road network concept. The documentation is based on the nodes shown in Fig.~\ref{fig_schema}. 
\begin{figure}[thpb] 		
	\centering
	\includegraphics{fig/schema.pdf}
	\caption{Hierarchical structure of the road network. On the first level all segments and their relation to each other are defined. In addition, it is possible to define the automatic connection of two road ends. Segments are defined as roundabouts, junctions and connection roads. $r_i$ and $I$ describe roads and intersection definitions, respectively}
	\label{fig_schema}
\end{figure}
\subsection{Reference Lines} \label{sec_refline} % or find better heading 
In order to ensure a smooth driveability along the road network, we define that the curvature has to be continuous along roads (where curvature is defined as the reciprocal of the radius). Therefor, the definition of curvature over distance, a start point and initial heading is sufficient to uniquely describe a road's course. This, at the same time implies that in contrast to OpenDRIVE it is not necessary to state the start point and heading of each geometric primitive. Fig.~\ref{fig_curvGraph} shows the definition of a road segment that is composed of the geometric primitive sequence line-spiral-arc-spiral-line.

As shown in Fig.~\ref{fig_curvGraph}, the curvature $\kappa(s)$ is a piecewise linear defined function over distance. Since we use lines, spirals and arcs, three definitions for those pieces are required. A line is described by $\kappa(s) = 0$ which means, only a length $L$ needs to be specified. An arc's course is defined by a constant curvature $\kappa(s) = \kappa_\text{arc} = \text{const}$. Therefor, an arc is defined by a length $L$ and a radius $R$. Note that we use radii in the input description because they are more intuitive than the curvature. Finally, a spiral is characterized by a linear change of curvature: $\kappa(s) = a s$, where $a$ is constant (for details on spirals cf. [ref]). Consequently, in addition to the length $L$, the start and end radius $R_s$ and $R_e$ need to be defined for a spiral to be unique. Those definitions are then being concatenated to a curvature graph and result in an unambiguous road course in the $x,y$-plane if either the initial values for position and orientation at the start are provided or the road is connected to another segment without a curvature jump.

%% maths prob. later, better describe input
%If the initial values $\phi_\text{0}, x_\text{0}, y_\text{0}$ are provided, the plan view coordinates can be calculated as follows:
%\begin{equation} \label{eq1}
%\begin{split}
%\phi(s) &= \int_0^s \kappa(\hat{s}) d\hat{s} + \phi_\text{0} \\ 
%x(s) &= \int_{0}^{s} \cos(\phi(\hat{s})) d\hat{s} + x_\text{0} \\ 
%y(s) &= \int_{0}^{s} \sin(\phi(\hat{s})) d\hat{s} + y_\text{0} \\
%\end{split}
%\end{equation}
\begin{figure}%[thpb] 		
	\centering
	\includegraphics{fig/curvGraph.pdf}
	%&\input{fig/curveDescription.tex}
	\caption{Qualitative example for a curve defined by the curvature graph. The plan view results from two integrations over $s$. Geometric primitives: line-spiral-arc-spiral-line. Positive curvature values correspond to left turns in positive $s$ direction.}
	\label{fig_curvGraph}
\end{figure}

\subsection{Segements}\label{sec_segments}
Below, the segments which might be defined in the road network input are described starting with connections roads, followed by junctions and roundabouts.

Connection roads consist of single \textit{road} tags defined by a reference line and definition for lanes and signals in the $s,t$-coordinate system. The latter is a moving coordinate system along the distance $s$. The $t$-coordinate is defined as the offset parallel to the reference line at position $s$. Lane extension and merging follow 3rd degree polynomials which are stated by their start and end point in $s,t$-coordinates, the corresponding polynomial coefficients are calculated by the road generation tool.

At least two and at most three \textit{road} entities are required to create a T-junction. Often one road is the dominant or main road in an intersection, which can be exploited by defining it as a single road that is intersected by an access road. Alternatively, three single roads can be combined to form a T-junction by defining one reference road and the angles at which the other two roads are connected. The main idea of the intersection concept is that each road is defined in its own local coordinate system (cf. Fig.~\ref{fig_juncDef}~a)) and then is combined as shown in Fig.~\ref{fig_juncDef}~b). E.g., the T-junction in Fig.~\ref{fig_juncDef} consists of a main road described by an arc and an access road whose course follows a line. The main road is intersected by the access road around its center ($s_1$) whereas road two is connected at its origin ($s_2=0$) under the angle $\alpha$. The reference coordinate system of the segment now is that of road one. The described road combinations are defined within "coupler"-tags which are indicated by the $I$-knots of Fig.~\ref{fig_schema}.

In addition to topological information of the junction, it is possible to define the intersection area more detailed. First, for each road arm the distance from the intersection point to the beginning of the junction can be specified. The latter means the point where turning lanes start to leave the course of the reference line. Fig.~\ref{fig_createJunction} shows the concept of the intersection area. Furthermore, additional lanes for left and right turns can be added ad libitum. Those lanes are specified by their minimal radius, the concrete course is calculated automatically (cf.~Sec.~\ref{sec_inters}). The descriptions of T- and X-junctions are a lot alike and thus X-junctions can be created analogously to the preceding paragraph about T-junctions.
\begin{figure}[thpb] 		
	\centering
	\includegraphics{fig/junctionDef.pdf}	
	\caption{Two roads are coupled to form a T-junction. Road 1 is defined as an arc by length and curvature whereas road 2 is a straight line with length $L_l$. On both roads the intersection point along $s$ is defined. In addition, the angle $\alpha$ at this point is stated. }
	\label{fig_juncDef}
\end{figure}

\emph{Roundabouts ...} % TODO: very shortly describe roundabouts

\subsection{Complete the Road Network}
Once all desired segments are specified, those may be concatenated to form a road network. In general, all segment types can be combined with each other. The only condition is that the curvature at the connection point is mutual to fulfill the continuous curvature condition we introduced for reference lines. However, in the current state of the road generation tool the curvature has to be zero at the connection to combine two segments. Fig.~\ref{fig_concatSeg} illustrates the combination of an X-junction, connection road and T-junction. In this example, segment \textbf{I} provides the reference coordinate system which can be placed at any position and orientation $x_\text{offset}, y_\text{offset}$ and $\alpha_\text{offset}$ in world coordinates. Next, the connections between \textbf{I} and \textbf{II} as well as \textbf{II} and \textbf{III} are defined in a linking tag by stating which segment endings are linked. With this information, the road generation tool is able to generate an OpenDRIVE map uniquely.
\begin{figure}[thpb] 		
	\centering
	%\includegraphics[width=0.9\columnwidth]{fig/concatSegments.png}
	\includegraphics{fig/concatSegments.pdf}
	\caption{Three segments are concatenated to form a road network. First, one reference segment has to be set (I). For further connections only the two end points need to be specified because concatenation follows the continuous curvature condition.}
	\label{fig_concatSeg}
\end{figure}

One more option of the road network concept is the automated generation of a compound curve (composed of two spirals with an arc between them) to close the gap between two loose road ends. This might be required if the road network should be used for endurance simulations where traffic agents shall drive in circles infinitely often and no sources and sinks are implemented in the simulation environment. Since it is not possible to calculate a curvature graph which matches a desired end point in the $x,y$-plane from an known start point analytically, an optimization problem needs to be solved to match $\kappa=0$ and this end point.
\textit{explain the why and how...} %TODO: extend close road network a little

\section{ROAD GENERATION / IMPLEMENTATION}
The specified input may be translated into the road network standard format OpenDRIVE by a command line tool. Since the input describes a simplified representation of the road network, missing information needs to be calculated to provide a verified OpenDRIVE map. In the following, some steps of these calculations are described starting with details on geometric properties of roads and lanes followed by the generation of intersections. 
\subsection{Geometry}
	As introduced Sec.~\ref{sec_refline}, we assume that a roads reference line is curvature continuous and therefor a single initial position and heading is sufficient. However, OpenDRIVE requires a start point and heading for each line, arc or spiral. In order to provide information on $x,y$-coordinates and orientation $\varphi$ for each geometric primitive, a transformation depending on the geometry type is necessary. For a straight line, the following trivial equations result:
    \begin{equation}
        \varphi(s) = \varphi_0, \quad x(s) = s \cos(\varphi_0), \quad y(s) = s \sin(\varphi_0)\text{.}
        \label{eq_line}
    \end{equation}
    With a segment of a circle, however, the orientation also changes along $s$. With constant curvature $\kappa$ and the angle $\varphi(s) = s \kappa + \varphi_0$ this results in:
    \begin{equation}
    \begin{split}
        x(s) &= \frac{1}{\kappa} \left(\sin\varphi(s) - \sin\varphi_0 \right)\\
        y(s) &= \frac{1}{\kappa} \left(\cos\varphi_0 - \cos\varphi(s) \right) \text{.}
    \end{split}
    \label{eq_arc}
    \end{equation}
    For a spiral the coordinates along $s$ can be described with a parameter \(a = \frac{1}{\sqrt{2Rs}} = \sqrt{\frac{\kappa}{2s}}\) which is constant at any point of the spiral (cf. [ref]) and the following equations: 
    \begin{equation} 
        x = \frac{1}{a}\int_0^{as}  \cos\left(t^2\right)dt, \quad y = \frac{1}{a}\int_0^{as}  \sin\left(t^2\right)dt \text{.}
        \label{eq_spiral}
    \end{equation}
	These formulas are called Fresnel integrals and it can be shown that there is no analytical solution to them. However, they can be approximated by a power series expansion for sine and cosine [ref.]. With help of \ref{eq_line} to \ref{eq_spiral} missing information for each reference line can be calculated such that OpenDRIVE requirements are fulfilled.

    In a further step, lanes are added to the reference line. Each is described by a lane type, a marking, and especially by a width $w$, which corresponds to the local $t$ coordinate $t_\text{lane}(s)=t(s)-t_0$ where $t_0$ is the constant offset of the lane to the reference line. The lane width is unambiguously described by a third-order polynomial of the form $t_\text{lane}(s) = as^3 + bs^2 + cs + d$ with coefficients \(a,b,c,d\). Lanes are divided into lane sections in which those polynomials are valid. Note that the $s$ coordinate is zero at the beginning of a road but not of a lane section. In the simplest case, $w$ is constant and $a=b=c=0, d=w$ holds. If a lane widening occurs, the lane width increases from $t_\text{lane}(s_0)=0$ to the final width $t_\text{lane}(s_0+ds)=w$ over a given length $ds$. Additional conditions for modeling the four polynomial coefficients are continuous transitions \(\left(t_\text{lane}'(s) = 0\right)\) at start and end of the widening $s_0$ and $s_0 + ds$, respectively. This case, the four coefficients can be uniquely solved with help of the described conditions. A lane lapse behaves analogously but starting with $t_\text{lane}(s_0)=w$ and ending with $t_\text{lane}(s_0+ds)=0$
        
\subsection{Intersections}\label{sec_inters}
    \begin{figure}[thpb]        
        \centering
        \includegraphics{fig/createJunction.pdf}
        \caption{From logical definition to concrete intersection. After the reference lines are in the correct position a), corresponding lanes are generated (b). Subsequently, the intersection area is cut free (c) and all required connection lanes are generated automatically (d).}
        \label{fig_createJunction}
    \end{figure}
	
    Besides the reference lines, the intersections and roundabouts specified in the input file have to be processed in order to form valid OpenDRIVE entities. Each intersection or roundabout consists, as shown in Fig.~\ref{fig_schema}, of corresponding roads \(r_i\) as well as more detailed information \(I\). The latter specifies the junction center by $s$-coordinates at which the roads intersect and the angles to the reference road (cf. Fig.~\ref{fig_juncDef}). Furthermore, a coupler tag exists, which defines the intersection area with its lanes in more detail. Besides the size of the intersection area, it also specifies which lanes of the individual roads are connected or whether additional lanes are added before the intersection.

    A segment is constructed such that the junction midpoint lies in the origin and intersects the reference road without any angle. Further roads \(r_i\) intersect the origin at the specified road position \(s_\text{I,i}\) at a defined angle \(\alpha_\text{I,i}\), so that the starting point and the starting angle of each geometry of this road must be shifted by a translatory offset \(\tilde{x}, \tilde{y}\) and rotated around the angle \(\tilde{\varphi} = \alpha_\text{I,i}\). The translatory offset can be determined from the coordinates at position \(s_\text{I,i}\) so that all segments with their starting points \(x_0,y_0,\varphi_0\) can be transformed as follows.

    \begin{align} \label{eq_transform}
        \begin{split}
            x &= \cos(\tilde{\varphi}) \left(x_0-\tilde{x}\right) - \sin(\tilde{\varphi}) \left(y_0-\tilde{y}\right) \\
            y &= \sin(\tilde{\varphi}) \left(x_0-\tilde{x}\right) + \cos(\tilde{\varphi}) \left(y_0-\tilde{y}\right) \\
            \varphi &= \varphi_0 + \tilde{\varphi} \\
        \end{split}
    \end{align}

    Before inserting new connecting roads, the junction area has to be generated, which requires a cut in the reference line of each road $r_i$. From the junction midpoint at \(s_\text{I,i}\) we define \(s_A\) as the length along $s$ which spans the junction area in one direction. Note that for simplicity we assume \(s_A\) in both directions of the reference line in the documentation. In practice those are two variables. From the defined reference line of $r_\text{i}$, two parts are extracted: the part up to the beginning of the junction \((-\inf,s_I - s_A]\) and the part behind the junction \([s_I + s_A, \inf)\). The two relevant points of the reference line are now iteratively copied over all geometries to generate the new exit roads of the intersection. Depending on the cut of straight line, arc or spiral, the respective segment of the reference line has to be adapted. The result of this step can be illustrated as shown in Fig.~\ref{fig_createJunction}~c).
    
    %Iterating over all geometries can result in four different cases, as seen in Figure \ref{fig_geometryCut}. 
    %\begin{figure}[]    
    %    \includegraphics[width= \columnwidth]{fig/geometryCut.pdf}
    %    \caption{possible cases for reference line cutting}
    %    \label{fig_geometryCut}
    %\end{figure}

    %For case a), the starting cut takes place in the geometry so that the new start point is calculated first, and then the geometry is adjusted concerning length and starting curvature. Similarly, in case of b), the end cut is made, which changes the length and, in case of a spiral, the end curvature of the geometry, respectively. In the third case c), both cuts are made in the current geometry so that the start point, as well as the length and the curvatures, are adjusted. In the fourth case d), no cut is performed, so the current geometry remains unchanged.

    After every street is cut and correctly positioned, the next step is calculating the reference lines of the lanes inside of the intersection area. Each lane is generated as an individual street with its reference line, whereby the single-lane lies to the right of the reference line. Based on starting point \(A\) and endpoint \(B\) as well as the angles \(\varphi_{A}\) and \(\varphi_{B}\) the new reference line of a lane is calculated. As a simplification, only straight lines and arcs are used since the discontinuity in the curvature can be neglected at low speeds. Note that the assumption still yields continuous angles along $s$. The setup for one connection road is illustrated in Fig.~\ref{fig_connecting_road}. $A$ is the end of the road entering the junction area and $B$ is the corresponding start of the newly generated road leaving the junction. In the following, the geometric construction of the new reference line is described.
    \begin{figure}[thpb]
    	\input{fig/roadConnection.tex}
    	\caption{process for connecting roads in junction area}
    	\label{fig_connecting_road}
    \end{figure}

    In the first step, the endpoints are extended with straight lines to calculate the intersecting point \(I\). 
    \begin{align}
        \begin{split}
            I_x &= \frac{B_y - A_y + \left(\tan(\varphi_A) A_x - \tan(\varphi_B) B_x\right)}{\tan(\varphi_A) - \tan(\varphi_B)} \\
            I_y &= \tan(\varphi_A) \cdot I_x + \left(A_y - \tan(\varphi_A) A_x\right)\\
        \end{split}     
    \end{align}

    The euclidean distances $d_\text{A} = \|A-I\|$ and $d_\text{B} = \|B-I\|$ between endpoints and intersection point are then being calculated and the road with further distance is extended by a line until the new distances are equal, which introduces the new helping point \(H\) at the end of the extended line. Finally, the two points are connected by an arc with radius \(r\) and length \(l\). The following equation determines the parameters of the circle, where \(\beta = \varphi_B - \varphi_A\):
    \begin{align}
        \begin{split}           
        r &= \frac{\sqrt{\left(H_x - A_x\right)^2 + \left(H_y - A_y\right)^2}}{2 \cdot \sin\left(\frac{\beta}{2}\right)} \\
        l &= \vert r \cdot \left(\varphi_B - \varphi_A\right) \vert \\  
        \end{split}
    \end{align}
    
    This procedure is repeated until all connection roads, i.e. lanes, inside the junction are calculated.

\section{RESULTS}
In Fig.~\ref{fig_res3_2} the OpenDRIVE output of two concatenated T-junctions is shown. Both are defined mostly the same, only differences for the upper junction is that the radius of the main road is smaller and that an option is activated which automatically generates lane widenings for left turns on main roads. In fact, only two chars are different in the respective junction definitions which makes the description easy to vary. In addition, the input file consists of four defined roads whereas the resulting OpenDRIVE file contains 18 road definitions. These effects have impact on the overall amount of code which can be seen in Table~\ref{tab_comparison}~line 2. The input file requires only $5.3\%$ as many chars as the concrete OpenDRIVE file.
\begin{figure}[thpb]
	\includegraphics[width=\columnwidth]{fig/res3_2.png}
	\caption{OpenDRIVE Output of two concatenated T-junctions. Both junctions are almost identically defined. The only differences for the upper junction are that the radius of the main road is changed and an option that automatically generates lane widening for left turns is activated. Note that black lines indicate lane courses, not their marking.}
	\label{fig_res3_2}
\end{figure}

As an general overview, in Fig.~\ref{fig_resHuge} the result for a considerably large road network is illustrated. It  is described entirely by the presented logical description and then is instantiated as OpenDRIVE with help of the developed tool. The network consists of four intersections, one roundabout and several connection roads. Further, all open ends are automatically closed employing the mentioned road network closing tag. As shown in Table~\ref{tab_comparison} line 3, the input file is significantly smaller in terms of code length than the resulting OpenDRIVE file. In addition, only little parts of the input have to be changed (e.g. the curvature of one connection road) in order to obtain a road network of similar topology but with thousands of changes in the OpenDRIVE file.
\begin{figure*}[thpb]
	\includegraphics[width=\textwidth]{fig/res_huge.PNG}
	\caption{OpenDRIVE Output of road network generated by the tool which processes the developed logical road description}
	\label{fig_resHuge}
\end{figure*}
\begin{table}[h]
\caption{Comparison of OpenDRIVE and logical description in terms of amount of code}
\label{tab_comparison}
\def\arraystretch{1.5}
\begin{center}
\begin{tabular}{l|cccc}
\multirow{2}{*}{File} & \multicolumn{2}{c}{OpenDRIVE} & \multicolumn{2}{c}{Logical Description}\\
& Lines & Chars & Lines & Chars \\
\hline
XJunc (Fig.~\ref{fig_motivation}) & $875$ & $32,468$& $4.0\%$ &$4.1\%$\\
TwoTJunc (Fig.~\ref{fig_res3_2}) & $937$ & $36,414$& $5.0\%$ &$5.3\%$\\
HugeRoadNet (Fig.~\ref{fig_resHuge}) & $6,301$ & $242,803$& $3.9\%$ &$4.8\%$
\end{tabular}
\end{center}
\end{table}

\section{CONCLUSIONS} %TODO: Conclusion / Discussion

\addtolength{\textheight}{-12cm}   % This command serves to balance the column lengths
                                  % on the last page of the document manually. It shortens
                                  % the textheight of the last page by a suitable amount.
                                  % This command does not take effect until the next page
                                  % so it should come on the page before the last. Make
                                  % sure that you do not shorten the textheight too much.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bibliographystyle{IEEEtran}
\bibliography{IEEEexample,ma_russ,anonymization,roadgen}

\end{document}
